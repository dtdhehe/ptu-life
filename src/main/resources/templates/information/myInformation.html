<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>我的资料</title>
    <!-- bootstrap基础 -->
    <link rel="stylesheet"
          th:href="@{/js/bootstrap/css/bootstrap.min.css}" />
    <link rel="stylesheet"
          th:href="@{/js/bootstrap/css/font-awesome.min.css}" />
    <link rel="stylesheet" th:href="@{/js/bootstrap/css/animate.css}" />
    <!-- bootstrap-table列表 -->
    <link rel="stylesheet"
          th:href="@{/js/bootstrap/css/bootstrap-table.css}" />
    <!-- layui -->
    <link rel="stylesheet"
          th:href="@{/js/layui/css/layui.css}" />
    <style type="text/css" >
        .background{
            width: 100%;
            height: 350px;
            position: relative;
        }
        .background img{
            width: 100%;
            height: 100%;
        }
        .head_portrait{
            position: absolute;
            width: 300px;
            height: 180px;
            top: 120px;
            left: 540px;
            text-align: center;
        }
        .head_portrait img{
            width: 120px;
            height: 120px;
        }
        .nickName{
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
            font-size: x-large;
        }
        .motto{
            margin-top: 5px;
            text-align: center;
        }
        .my_nav{
            background-color: #F5F5F5;width: 300px;padding: 0;border-radius: 2px;
        }
        .level{
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
        }
        .level li{
            float: left;
        }
        .level li a{
            height:60px;line-height:60px;
        }
        .my_nav *{
            font-size: medium;
        }
        .my_nav li{
            cursor: pointer;
            padding: 0 20px;
        }
        /*选择行样式*/
        .my_nav .itemed{
            /*background-color: #e7e7e7;*/
            font-weight: bold;
        }
        .my_nav a{
            position: relative;height:100px;line-height:100px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;
            display: block;
        }
        .my_nav a:hover,li:hover{
            background-color: #e7e7e7;
        }
        .my_info{
            padding: 0 50px;
        }
        .my_info button{
            margin-left: 100px;
            width: 150px;
            height: 40px;
        }
    </style>
</head>
<body>
<!--引入导航栏-->
<div th:replace="navbar.html"></div>
<!--个人简介-->
<div>
    <!--个人背景图-->
    <div class="background">
        <img th:src="@{/img/background.jpg}" />
    </div>
    <!--用户头像-->
    <div id="head_portrait" class="head_portrait">
        <img alt="140x140" src="http://ibootstrap-file.b0.upaiyun.com/lorempixel.com/140/140/default.jpg" class="img-circle" />
        <p class="nickName" th:text="${currentUser.nickName}">昵称</p>
        <p class="motto" th:text="${currentUser.motto}">这家伙真懒，什么都没有留下...</p>
    </div>
</div>
<div class="col-md-12 column" style="margin-top: 20px;margin-bottom: 40px">
    <div class="col-md-3 column" style="min-height: 473px">
        <ul id="navMenu" class="my_nav">
            <li class="itemed"><a href="javascript:void(0);" onclick="changeMenu(this,'myInformation')">我的资料</a></li>
            <li class=""><a href="javascript:void(0);" onclick="changeMenu(this,'myNews')">我的文章</a></li>
            <li class=""><a href="javascript:void(0);" onclick="changeMenu(this,'myAnswer')">我的问答</a></li>
            <li class=""><a href="/login/loginController/logout">退出</a></li>
        </ul>
    </div>
    <div class="col-md-9 column">
        <ul id="infoTitle" class="my_nav level">
            <li id="first" class="itemed"><a href="javascript:void(0);" onclick="changeInfos(this,'baseInfo')">基本信息</a></li>
            <li class=""><a href="javascript:void(0);" onclick="changeInfos(this,'otherInfo')">其他信息</a></li>
            <li class=""><a href="javascript:void(0);" onclick="changeInfos(this,'pwdInfo')">修改密码</a></li>
        </ul>
        <ul id="menuInfoTitle" style="display: none" class="my_nav level">
            <li class="itemed"><a></a></li>
        </ul>
        <!--具体信息页面-->
        <iframe id="iframeInfo" name="iframeInfo" style="width: 100%;min-height: 280px" scrolling="no" frameborder="0"></iframe>
        <div id="save" class="my_info">
            <button id="saveInfo" onclick="save()" class="btn btn-info">保存</button>
        </div>
    </div>
</div>
<!--引入页脚-->
<div th:replace="footer"></div>
<!-- 全局js -->
<script type="text/javascript" th:src="@{/js/jquery.min.js}"></script>
<script type="text/javascript"
        th:src="@{/js/bootstrap/js/bootstrap.min.js}"></script>
<!-- bootstrap-table列表-->
<script type="text/javascript"
        th:src="@{/js/bootstrap/js/bootstrap-table.js}"></script>
<script type="text/javascript"
        th:src="@{/js/bootstrap/js/bootstrap-table-zh-CN.js}"></script>
<!--引入layui的js-->
<script type="text/javascript"
        th:src="@{/js/layui/layui.all.js}"></script>
<!--引入标签js-->
<script type="text/javascript"
        th:src="@{/js/init/init.js}"></script>
<!-- js 方法 -->
<script th:inline="javascript">
    //<![CDATA[
    $(function () {
        //初始化函数
        iFrameHeight();
        //首次加载基础页面
        $("#iframeInfo").attr("src",[[@{/myInformationController/getFormInfo}]]+"?infoName="+"baseInfo");
        //打印当前登录用户
        console.log([[${session.loginUser}]]);
        var loginUser = [[${session.loginUser}]];
        if (loginUser === null) {
            $("#loginBtn").css("display","");
        }else {
            $("#logoutBtn").css("display","");
        }
    });

    //让iframe自适应子页面大小
    function iFrameHeight() {
        $("#iframeInfo").load(function () {
            var height = $("#iframeInfo").contents().find("body").height()+10;
            $("#iframeInfo").attr("height",height);
        });
    }

    function loginStatus(status) {
        if (status === "regist"){
            window.location.href = [[@{/ptu/homePageController/registPage}]];
        }else {
            window.location.href = [[@{/login/loginController/logout}]];
        }
    }

    //切换信息页面
    //obj:当前节点  infoName:信息页面名称
    function changeInfos(obj,infoName) {
        //清除所有的选中样式
        $("#infoTitle li").removeClass("itemed");
        //给当前选中栏添加样式
        $(obj).parent().addClass("itemed");
        //跳转iframe
        $("#iframeInfo").attr("src",[[@{/myInformationController/getFormInfo}]]+"?infoName="+infoName);
    }

    //切换菜单
    function changeMenu(obj, menuName) {
        //清除所有的选中样式
        $("#navMenu li").removeClass("itemed");
        //给当前选中栏添加样式
        $(obj).parent().addClass("itemed");
        //判断是否显示我的资料
        var menu = $(obj).text();
        if (menu !== "我的资料"){
            $("#infoTitle").css("display","none");
            $("#menuInfoTitle").css("display","");
            $("#save").css("display","none");
            $("#menuInfoTitle li a").text(menu);
        }else {
            $("#infoTitle").css("display","");
            $("#save").css("display","");
            $("#menuInfoTitle").css("display","none");
            //重新切回我的资料时，给基础信息栏赋上样式
            $("#infoTitle li").removeClass("itemed");
            $("#infoTitle li[id='first']").addClass("itemed");
        }
        //菜单页跳转
        $("#iframeInfo").attr("src",[[@{/myInformationController/getFormInfo}]]+"?infoName="+menuName);
    }

    //保存事件
    function save() {
        // debugger;
        layer.confirm("确定要保存修改吗?",{
            btn:['确定','取消'],
            title:"提示"
        },function () {
            var form = $(window.frames["iframeInfo"].document).find("#formInfo").serializeArray();
            var urls = '';
            if (form.length === 3){
                //修改密码
                urls = '/myInformationController/revisePassword';
            }else if (form.length === 4){
                //修改基本信息
                urls = '/myInformationController/reviseBaseInfo';
            }else {
                //修改其他信息
                urls = '/myInformationController/reviseOtherInfo';
            }
            $.ajax({
                url:urls,
                async:true,
                type:'POST',
                data:{
                    object: JSON.stringify(form)
                },
                success:function (data) {
                    if (data.status === "0"){
                        layer.alert(data.error_msg,function (index) {
                            window.location.href= '/myInformationController/getMyInformation';
                        });
                    }else {
                        layer.alert(data.error_msg);
                    }
                }
            });
        });
    }

    //]]>
</script>
</body>
</html>