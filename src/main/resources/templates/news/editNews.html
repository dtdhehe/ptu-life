<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>新闻</title>
    <!-- bootstrap基础 -->
    <link rel="stylesheet"
          th:href="@{/js/bootstrap/css/bootstrap.min.css}" />
    <link rel="stylesheet"
          th:href="@{/js/bootstrap/css/font-awesome.min.css}" />
    <link rel="stylesheet" th:href="@{/js/bootstrap/css/animate.css}" />
    <!-- bootstrap-table列表 -->
    <link rel="stylesheet"
          th:href="@{/js/bootstrap/css/bootstrap-table.css}" />
    <!-- layui -->
    <link rel="stylesheet"
          th:href="@{/js/layui/css/layui.css}" />
    <!--公共css-->
    <link rel="stylesheet" th:href="@{/css/public.css}" />
    <!--新闻编辑页面css-->
    <link rel="stylesheet" th:href="@{/css/news/editNews.css}" />
</head>
<body>
<!--引入导航栏-->
<div th:replace="navbar.html"></div>
<div class="margin-to-nav"></div>
<!--主体页面   新闻和标签-->
<div class="container">
    <div class="row clearfix">
        <!--新闻标题-->
        <div class="col-md-8 column">
            <div>
                <h1 class="text-left">
                    新闻标题：<input id="newsTitle" class="editTitle" type="text" placeholder="请在此处输入标题"/>
                </h1>
                <p class="authorInfo">
                    <img alt="头像" th:src="${currentUser.headImg}" class="img-circle" />
                    <span id="newsAuthor" class="authorName" th:text="${currentUser.nickName}"></span>
                    <img alt="140x140" th:src="@{/img/data/data.png}" class="img-default date-icon" />
                    <span id="newsDate" class="date-info" th:text="${date}"></span>
                    <span class="publish"><button id="publishNews" class="btn btn-info">发布</button></span>
                </p>
                <hr/>
            </div>

            <!--新闻主体-->
            <div class="media well">
                <div class="newsBody">
                    <textarea id="demo" ></textarea>
                    <hr/>
                    <p th:text="${currentUser.nickName}"></p>
                </div>
            </div>
        </div>
        <div class="col-md-4 column">
            <!--作者信息-->
            <div th:replace="tpl/authorInfo"></div>

            <!--热门标签-->
            <!--引入标签html代码-->
            <div th:replace="hotLabel.html"></div>

            <!--&lt;!&ndash;热门问答&ndash;&gt;-->
            <!--<div>-->
                <!--<div class="panel panel-info">-->
                    <!--<div class="panel-heading">-->
                        <!--<h3 class="panel-title">-->
                            <!--热门问答-->
                            <!--<span style="float:right;margin-right: 10px">热度</span>-->
                        <!--</h3>-->
                    <!--</div>-->
                    <!--<div class="panel-body">-->
                        <!--<a href="#">食堂鱼为什么不刮鱼鳞</a>-->
                        <!--<span style="float:right;margin-right: 20px">80</span>-->
                    <!--</div>-->
                    <!--<div class="panel-footer">-->
                        <!--<a href="#"> 金荣楼为什么没有空调</a>-->
                        <!--<span style="float:right;margin-right: 20px">160</span>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->
        </div>

    </div>
</div>
<!--引入页脚-->
<div th:replace="footer.html"></div>
<!-- 全局js -->
<script type="text/javascript" th:src="@{/js/jquery.min.js}"></script>
<script type="text/javascript"
        th:src="@{/js/bootstrap/js/bootstrap.min.js}"></script>
<!-- bootstrap-table列表-->
<script type="text/javascript"
        th:src="@{/js/bootstrap/js/bootstrap-table.js}"></script>
<script type="text/javascript"
        th:src="@{/js/bootstrap/js/bootstrap-table-zh-CN.js}"></script>
<!--引入layui的js-->
<script type="text/javascript"
        th:src="@{/js/layui/layui.all.js}"></script>
<!--引入标签js-->
<script type="text/javascript"
        th:src="@{/js/init/init.js}"></script>
<!-- js 方法 -->
<script th:inline="javascript">
    //<![CDATA[
    $(function () {
        layui.use('layedit',function () {
            var layedit = layui.layedit;
            layedit.set({
                uploadImage:{
                    url:[[@{/upload/uploadController/uploadEditPic}]],//接口url
                    type:'POST'//请求方式
                }
            });
            var editIndex = layedit.build("demo",{
                height:500
            });
            //发布按钮点击响应
            $("#publishNews").on('click',function () {
                publishNews(editIndex);
            });
        });
        //打印当前登录用户
        console.log([[${session.loginUser}]]);
        var loginUser = [[${session.loginUser}]];
        if (loginUser === null) {
            $("#loginBtn").css("display","");
        }else {
            $("#logoutBtn").css("display","");
        }
        //初始化热门标签
        initLabel();
    });

    //初始化热门标签列表
    function initLabel() {
        var urls = [[@{/label/labelController/queryHotLabel}]];
        //1.请求url   2.标签页div的id
        initHotLabel(urls,"label_ul");
    }

    //发布新闻按钮事件
    function publishNews(index) {
        var author = $("#newsAuthor").text();
        var title = $("#newsTitle").val();
        var content = layui.layedit.getContent(index);
        var userId = [[${session.loginUser.userId}]];
        var news = {
            author:author,
            title:title,
            content:content,
            userId:userId
        };
        var urls = [[@{/news/newsController/saveNews}]];
        $.ajax({
            url:urls,
            async:true,
            type:'POST',
            data:{
                news: JSON.stringify(news)
            },
            success:function (data) {
                if (data.status === "0"){
                    layer.alert("保存成功!",function (index) {
                        window.location.href= [[@{/ptu/homePageController/home}]];
                    });
                }
            }
        });
    }

    //]]>
</script>
</body>
</html>